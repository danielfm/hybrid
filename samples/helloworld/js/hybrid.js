Hybrid={version:"0.1"};Hybrid.Engine=function(i){var h=this;i=i||{};function f(){var j=d.getStatistics();j.engine=h;return j}this.evolve=function(n){if(!d.isInitialized()){d.initialize(a)}var m=d.getInitialSize();while(!n.interrupt(f())){this.notify("newGeneration",f());var o=[];while(o.length<m){var k=g.select(a,d);var j=null;do{j=g.select(a,d)}while(j===k);var p=e.crossover(a,j,k,d);if(p){var l=c.mutate(a,p,d);o.push(((l)?l:p))}else{o.push(k);if(o.length<m){o.push(j)}}}d.replaceGeneration(o)}return d.best()};this.on=function(j,k,l){b.addListener(j,k,l)};this.unsubscribe=function(j){b.removeListener(j)};this.notify=function(j,k){b.notifyListeners(j,k)};this.getEventHandler=function(){return b};this.getRandomizer=function(){return a};this.setRandomizer=function(j){a=j};this.getSelection=function(){return g};this.setSelection=function(j){g=j};this.getCrossover=function(){return e};this.setCrossover=function(j){e=j};this.getMutation=function(){return c};this.setMutation=function(j){c=j};var a=i.randomizer||new Hybrid.Util.Randomizer();var d=i.population||new Hybrid.Population();var g=i.selection||new Hybrid.Reproduction.RandomSelection();var e=i.crossover||new Hybrid.Reproduction.Crossover();var c=i.mutation||new Hybrid.Reproduction.Mutation();var b=new Hybrid.Event.Handler()};Hybrid.Stop={};Hybrid.Stop.ElapsedGeneration=function(a){a=((!a||a<0)?100:a);this.interrupt=function(b){return(b.population.getGeneration()==a)}};Hybrid.Util={};Hybrid.Util.Array={map:function(g,e){var a=[];var d=g.length;for(var c=0;c<d;c++){var b=g[c];if(e){var f=e(b);if(f!=null){a.push(f)}}else{a.push(b)}}return a}};Hybrid.Util.Randomizer=function(){this.next=function(a){if(typeof a=="undefined"){return Math.random()}if(a.delta()<0){throw"'start' shouldn't be greater than 'end'"}return a.delta()*this.next()+a.getStart()};this.probability=function(a){return this.next()<=a}};Hybrid.Util.Range=function(c,a){if(a==null){a=(!c?0:c);c=0}if(c>a){var b=c;c=a;a=b}c;a;this.getStart=function(){return c};this.getEnd=function(){return a};this.isMember=function(d){return d>=c&&d<=a};this.delta=function(){return a-c}};Hybrid.Reproduction={};Hybrid.Reproduction.Crossover=function(){this.crossover=function(d,c,b,a){return null}};Hybrid.Reproduction.Mutation=function(){this.mutate=function(c,a,b){return null}};Hybrid.Selection=function(){this.select=function(c,b){var a=new Hybrid.Util.Range(b.getSize());return b.getIndividual(c.next(a))}};Hybrid.Selection.Tournament=function(a){this.select=function(b,d){var c=null;var k=d.getSize();var f=new Hybrid.Util.Range(k);var j=k*a;for(var e=0;e<j;e++){var g=parseInt(b.next(f));var h=d.getIndividual(g);if(c==null||h.fitness.isBetterThan(c)){c=h}}return c};a=((!a||a<0)?0.1:(a>1?1:a))};Hybrid.Selection.Ranking=function(){function a(b){b.sort();var e=0;var d=b.getSize();for(var c=0;c<d;c++){e+=c}return e}this.select=function(j,d){var h=0;var f=d.getSize();var c=a(d);var b=j.next(new Hybrid.Util.Range(c));var g=f-1;for(var e=0;e<f;e++,g--){h+=g;if(b<h){return d.getIndividual(e)}}return d.best()}};Hybrid.Population=function(l){var j=this;l=l||{};this.reset=function(m){b=false;f=[];a=false;g=0;i=m};this.initialize=function(o){if(b){throw new Hybrid.Population.AlreadyInitializedError()}g=0;this.notify("beforeInitialize",this.getStatistics());for(var n=0;n<i;n++){var m=d.create(o,this);if(m){this.add(m)}}i=f.length;b=true;this.notify("afterInitialize",this.getStatistics())};this.replaceGeneration=function(m){if(m.length!=f.length){throw new Hybrid.Population.IncompatibleBreedError()}var n=this.getStatistics();n.breed=m;this.notify("replaceGeneration",n);f=[];this.addAll(m);a=true;g++};this.sort=function(){if(a){a=false;f.sort(e.compare)}};this.add=function(m){this.notify("addIndividual",{individual:m,population:this});f.push(m);a=true};this.addAll=function(o){var n=o.length;for(var m=0;m<n;m++){this.add(o[m])}};this.best=function(m){this.sort();if(m==null){return f[0]}else{return f.slice(0,m)}};this.getSize=function(){return f.length};this.on=function(m,n,o){c.addListener(m,n,o)};this.unsubscribe=function(m){c.removeListener(m)};this.notify=function(m,n){c.notifyListeners(m,n)};this.getEventHandler=function(){return c};this.getIndividualFactory=function(){return d};this.setIndividualFactory=function(m){d=m};this.evaluateFitness=function(m){return h.evaluate(m,this)};this.getFitnessEvaluator=function(){return h};this.setFitnessEvaluator=function(m){h=m};this.compareIndividuals=function(n,m){return e.compare(n,m)};this.getFitnessComparator=function(){return e};this.setFitnessComparator=function(m){e=m};this.getGeneration=function(){return g};this.isInitialized=function(){return b};this.expireCache=function(){a=true};this.getInitialSize=function(){return i};this.getIndividual=function(m){return f[m]};this.getIndividuals=function(){return[].concat(f)};this.getStatistics=function(){return k.compute(this)};this.getStatisticsProvider=function(){return k};this.setStatisticsProvider=function(m){k=m};var g=l.generation;if(!g){g=0}var c=new Hybrid.Event.Handler();var k=l.statisticsProvider||new Hybrid.Population.StatisticsProvider();var i=((l.individuals)?l.individuals.length:((l.initialSize)?l.initialSize:100));var d=l.individualFactory||new Hybrid.Individual.Factory();var h=l.fitnessEvaluator||new Hybrid.Fitness.Evaluator();var e=l.fitnessComparator||new Hybrid.Fitness.Comparator();this.on("addIndividual",function(m){Hybrid.Individual.plugFitnessLogic(m.individual,j)});var f=[];if(l.individuals){this.addAll(l.individuals)}var b=!!l.individuals;var a=b};Hybrid.Population.Elitism=function(b,a){a.on("replaceGeneration",function(c){var d=c.breed;d=d.slice(b);d=d.concat(c.population.best(b));c.breed=d})};Hybrid.Population.StatisticsProvider=function(){this.compute=function(a){return{population:a}}};Hybrid.Population.AlreadyInitializedError=function(){};Hybrid.Population.IncompatibleBreedError=function(){};Hybrid.Fitness={};Hybrid.Fitness.Evaluator=function(){this.evaluate=function(a,b){return 0}};Hybrid.Fitness.Comparator=function(a){this.compare=function(c,b){return(b.fitness.get()-c.fitness.get())*((a)?-1:1)}};Hybrid.Individual={plugFitnessLogic:function(a,b){Hybrid.Individual.assertMonkeypatch(a);var c=null;a.fitness={_$:true,get:function(){if(c!=null){return c}c=b.evaluateFitness(a);return c},reset:function(){c=null;b.expireCache()},isBetterThan:function(d){return b.compareIndividuals(d,a)>0}}},assertMonkeypatch:function(a){if(a.fitness&&!a.fitness._$){throw new Hybrid.Individual.PlugFitnessError("fitness")}}};Hybrid.Individual.Factory=function(){this.create=function(b,a){return null}};Hybrid.Individual.PlugFitnessError=function(a){this.message="Cannot override individual attribute: "+a;this.name="PlugFitnessError"};Hybrid.Event={};Hybrid.Event.Handler=function(){this.addListener=function(b,c,d){if(b&&c){a.push({listener:c,type:b,params:d})}};this.removeListener=function(b){var c=Hybrid.Util.Array.map(a,function(d){return((b!=d.listener)?d:null)});a=c};this.removeListenersByType=function(c){var b=Hybrid.Util.Array.map(a,function(d){return((c!=d.type)?d:null)});a=b};this.getListenersByType=function(b){return Hybrid.Util.Array.map(a,function(c){return((b==c.type)?c.listener:null)})};this.notifyListeners=function(d,e){var c=Hybrid.Util.Array.map(a,function(g){return((g.type==d)?g:null)});for(var b=0;b<c.length;b++){var f=c[b];f.listener(e,f.params)}};this.getListeners=function(){return[].concat(a)};this.getListenersCount=function(){return a.length};var a=[]};